<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment Success</title>
</head>
<body>

<h2>Payment Status</h2>
<p id="statusMessage"></p>
<script>

const queryParams = new URLSearchParams(window.location.search);
const reference = queryParams.get("reference");
const token = localStorage.getItem("access_token"); // ✅ use correct token key
const VERIFY_URL = `https://backendlastproject.onrender.com/api/payments/paystack/verify/${reference}/`;

async function verifyPayment() {
    if (!token) {
        document.getElementById("statusMessage").textContent = "You must be logged in to verify payment";
        return;
    }

    if (!reference) {
        document.getElementById("statusMessage").textContent = "No payment reference found!";
        return;
    }

    try {
        const res = await fetch(VERIFY_URL, {
            headers: {
                "Authorization": `Bearer ${token}` // ✅ JWT style
            }
        });

        const data = await res.json();
        document.getElementById("statusMessage").textContent = `${data.status.toUpperCase()}: ${data.message}`;
    } catch (err) {
        document.getElementById("statusMessage").textContent = "Error verifying payment";
        console.error(err);
    }
}

verifyPayment();
</script>
</body>
</html>
